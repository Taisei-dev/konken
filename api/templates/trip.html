<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<meta name="format-detection" content="telephone=no">
<title></title>
<link rel="apple-touch-icon-precomposed" href="/img/appicon.png">
<link rel="stylesheet" href="../css/autocomplete.css" media="all">
<link rel="stylesheet" href="../css/import.css" media="all">
<!--<link rel="stylesheet" href="/common/css/fonts.css" media="all">-->
<link rel="stylesheet" href="../css/fonts.css" media="all">
<link type="text/css" rel="stylesheet" href="../ui/1.10.3/themes/cupertino/jquery-ui.min.css" />
<link href="../img/favicon.ico" rel="shortcut icon" />
<link rel="icon" href="/img/appicon.png">
<link rel="apple-touch-icon-precomposed" href="/img/appicon.png">
<script src="../jquery-1.10.2.min.js"></script>
<script src="../ui/1.10.3/jquery-ui.min.js"></script>
<script async src="../js/trunk2.js"></script>
<script async src="../js/busit-general.js"></script>
<script async src="../js/height.js"></script>
</head>
<body>

<!--言語切り替え-->
<section class="modal-window" id="modal-p01">
    <div class="modal-inner">
        <p>Change Language</p>
        <ul>
                        <li><a class="" href="/lang/ja">日本語</a></li>
                        <li><a class="check" href="/lang/en">English</a></li>
                        <li><a class="" href="/lang/ko">&#54620;&#44397;&#50612;</a></li>
                        <li><a class="" href="/lang/zh_CN">&#x4E2D;&#x6587;&#xFF08;&#x7B80;&#x4F53;&#xFF09;</a></li>
                        <li><a class="" href="/lang/zh_TW">&#x4E2D;&#x6587;&#xFF08;&#x7E41;&#x9AD4;&#xFF09;</a></li>
                    </ul>
    </div>
    <a href="#!" class="modal-close"></a>
</section>
<!--/言語切り替え-->
<div class="mask slide"></div>
    <div id="container" class="rote">
        <header class="slide">
            <div id="header">
            <p id="back"><a href="javascript:history.back()"></a></p>
            <p id="language"><a href="#modal-p01">Lang</a></p>
    <p class="menu"><img src="../img/common/icon_navi.png" width="45" height="45" id="navToggle" class="burger slide" alt=""></p>
</div>
        </header>
        <nav class="slide">
    <ul>
        <li class="navttl"><img src="../img/common/logo-top.png" alt="BUSit-バスイット"></li>
        <li><a href="/favorite/?StopID=etj00020-2"><i class="icon icon-star"></i>お気に入り</a></li>
                    <li><a href="/history/?stop_id=etj00020-2"><i class="icon icon-time"></i>履歴</a></li>
                                                            <li><a href="/stop/map/etj00020-2"><i class="icon icon-map"></i>地図を見る</a></li>
                            <li><a href="/search/on"><i class="icon icon-search"></i>バス停検索</a></li>
                <li><a href="/ptimetable/etj00020-2"><i class="icon icon-bus"></i>各バス会社リンク先</a></li>
        <li><a href="/feedback/stop/etj00020-2"><i class="icon icon-report"></i>問題を報告</a></li>
        <li><a href="/stop/guide/etj00020-2"><i class="icon icon-beginner"></i>使い方</a></li>
        <li><a href="/stop/disclaimer/etj00020-2"><i class="icon icon-guide"></i>免責事項</a></li>
        <!-- <li><a href="https://www.towncreation.com/product/busit-ad/stop_ad/" target="_blank"><i class="icon icon-image"></i>広告募集</a></li> -->
    </ul>
</nav><!--/drawer-->

        <div id="headWrap" class="slide">
            <!--バス詳細ナビ-->
            <div class="nav">
                <ul>
                    <li class="stay"><a href="21_151%3Fseq=7.html#stay">運行状況</a></li>
                                            <li class=""><a href="/times/21_151?seq=7#stay">時刻表</a></li>
                                        <li class=""><a href="javascript:showBusInfo()">運行会社</a></li>
                </ul>
            </div>
            <!--/バス詳細ナビ-->

            <!--到着バス・所要時間-->
            <div class="stopBusBox01 type01">
                <ul>
                    <li class="buscard" itemscope itemtype="http://schema.org/BusTrip">
                        <div class="head">
                            <p class="time" itemprop="departureTime"></p>
                            <p class="status"></p>
                        </div>
                        <div class="iconGroup">
                            <p>
                            </p>
                        </div>
                        <div class="btm">
                            <p class="company">
                            </p>
                            <div class="bordBox">
                                <div class="inBox">
                                    <!--系統名短表記-->
                                    <!--/系統名短表記-->
                                    <!--経由地と行先-->
                                    <p class="destination">
                                        <span class="route"></span>
                                        <span class="terminal"  itemprop="name">通過しました</span>
                                    </p>
                                    <!--/経由地と行先-->
                                </div>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
            <!--/到着バス・所要時間-->

            <!--前後のバス リンク-->
            <!--<ul class="navi_prevnext">
                <li class="prev no_link"><span>Previous</span></li>
                <li class="next"><span><a href="/trip/21_158?seq=7#stay">Next</a></span></li>
            </ul>-->
            <!--/前後のバス リンク-->
        </div><!--/headWrap-->
            <div class="content slide">
            <!--経路・運賃・到着時間-->
            <div class="routeBox01">
                <ul>

                </ul>
            </div>
            <!--/経路・運賃・到着時間-->
        </div><!--/content-->

    </div><!--/wrapper-->
    <div id="kurukendata" style="display:none">
    {{ kurukendata | safe }}
    </div>
    <script>
        var search=new URLSearchParams(window.location.search);
        var daiyasid=search.get('daiyasid');
        var stationsid=search.get('stationsid');
        //ヘッダー
        var imgbycomid={"bus-73086101":3,"bus-73008250":4,"bus-73385130":5,"bus-73385140":6,"bus-73308150":7,"bus-72700110":8,"bus-73900430":9,"bus-73208220":10,"bus-73805130":13,"bus-73885010":29,"bus-73785010":39,}
        var tripsearchresult=document.querySelector('#approach_list_for_daiya li.approachDtlCard div[data-sid="'+daiyasid+'"]');
        if(tripsearchresult){
            var trip=tripsearchresult.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement;
            var li=document.querySelector('li.buscard');
            li.innerHTML='<div class="head">'+
                        '   <p class="time" itemprop="departureTime">'+trip.querySelector('td.Time').innerText+'</p>'+
                        '   <p class="status">'+(trip.querySelector('div.changeCourseInner span.arrivedAboutMinPre')?('約'+trip.querySelector('div.changeCourseInner').innerText+'分で到着'):trip.querySelector('div.changeCourseInner').innerText)+'</p>'+
                        '</div>'+
                        '<div class="iconGroup">'+
                        '   <p>'+'<!--<span class="incompatible">バスロケ未受信</span>-->'+(trip.querySelector('td.BusType div.NonStep')?'<span class="nonStep">ノンステップ</span>':'')+(trip.querySelector('td.BusType div.OneStep')?'<span class="oneStep">ワンステップ</span>':'')+(trip.querySelector('td.BusSlope div.none')?'':'<span class="nonStep">スロープ</span>')+'<!--<span class="extraordinary">臨時便</span>-->'+'</p>'+
                        '</div>'+
                        '<div class="btm">'+
                        '   <p class="company">'+'<img src="../img/bus/icon_'+imgbycomid[trip.classList[0]]+'.png" width="44"/>'+'</p>'+
                        '   <div class="bordBox">'+
                        '       <div class="inBox">'+
                        '           <p class="num">'+trip.querySelector('td.KeitouNo').innerText+'</p>'+
                        '           <p class="destination">'+
                        '               <a href="javascript:void(0)">'+
                        '                   <span class="route">'+(trip.querySelector('div.IkisakiKeiyuName')?trip.querySelector('div.IkisakiKeiyuName').innerText:'')+'</span>'+
                        '                   <span class="terminal">'+trip.querySelector('td.CourseGroupName a').innerText+'</span>'+
                        '               </a>'+
                        '           </p>'+
                        '       </div>'+
                        '   </div>'+
                        '</div>';
            li.querySelector('p.destination a').href='javascript:'+trip.querySelector('td.CourseGroupName a').onclick.toString().slice(26.-2);
            if(trip.querySelector('div.changeCourseInner span.arrivingSoon')||trip.querySelector('div.changeCourseInner span.arrivingDoorOpen')||trip.querySelector('div.changeCourseInner span.arrivingTargetStation')){
                li.classList.add('soon');
            }
        }
        //詳細
        var jsondata={{ jsondata | safe }};
        if(Object.keys(jsondata).length!=0){
            var parent=document.querySelector('div.routeBox01 ul');
            jsondata['Daiya']['PassedSchedules'].forEach((val,index,array)=>{
                var li=document.createElement('li');
                li.innerHTML='<div class="inBox">'+
                            '   <div class="bstop_name">'+
                            '       <a href="/stop?stationsid='+val['Station']['Sid']+'">'+
                            '           <dl class="row">'+
                            '               <dt class="col_time">'+
                            '                   <p class="arv_time">'+val['ScheduledTime']['Value']+'</p>'+
                            '               </dt>'+
                            '               <dd class="col_stop">'+
                            '                   <div class="col_noriba">'+
                            '                       <!--<span class="stop_number">'+'1'+'</span>-->'+
                            '                   </div>'+
                            '                  <div class="col_Name">'+
                            '                       <span class="ruby_name">'+val['Station']['Yomigana']+'</span>'+
                            '                       <span class="StopName">'+val['Station']['Name']+'</span>'+
                            '                   </div>'+
                            '                </dd>'+
                            '            </dl>'+
                            '       </a>'+
                            '   </div>'+
                            '</div>';
                var halfwaypoint=document.createElement('li');
                halfwaypoint.classList.add('pass');
                halfwaypoint.innerHTML='<p class="halfwayPoint"></p>';
                if(val['Station']['Sid']===stationsid){
                    li.classList.add('stay');
                    var stay=document.createElement('p');
                    stay.id='stay';
                    li.appendChild(stay);
                    document.querySelector('p.time').innerText=val['ScheduledTime']['Value'];
                    document.querySelector('#back a').innerText=val['Station']['Name'];
                    document.querySelector('#back a').href='/stop?stationsid='+stationsid;
                    document.title='運行状況　'+val['Station']['Name'];
                }
                if(index==jsondata['Passages'].length-1){
                    var now=document.createElement('p');
                    now.classList.add('bus_now');
                    now.innerHTML='<img src="/img/common/icon_busnow.png" width=115>';
                    (jsondata['Passages'][index]['StartTime'][6]=='-'?li:halfwaypoint).appendChild(now);
                    
                    if(!stationsid){
                        //stationsidがなかった場合近い停留所に移動
                        li.classList.add('stay');
                        var stay=document.createElement('p');
                        stay.id='stay';
                    }
                }
                parent.appendChild(li);
                if(index!=array.length-1){
                    parent.appendChild(halfwaypoint);
                }
            });
            function showBusInfo(){
                var numberplate=jsondata["Bus"]["NumberPlate"],
                companyname=jsondata["Bus"]["Company"]["Name"],
                eigyosho=jsondata["Bus"]["Office"]["EigyoshoName"],
                rosenname=jsondata["Daiya"]["Course"]["Name"],
                driver=jsondata["Driver"]?jsondata["Driver"]["Name"]:"";
                alert('会社: '+(companyname||" - ")+'\n営業所: '+(eigyosho||" -")+'\nナンバー: '+(numberplate||" - ")+'\n路線名: '+(rosenname||" - ")+'\n運転手: '+(driver||" - "));
            }
            window.location.hash='stay';
        }
        else{
            document.querySelector('span.terminal').innerText='データがありません';
        }
    </script>
</body>
</html>
